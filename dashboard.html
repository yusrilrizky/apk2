<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spotify Dashboard</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #1e1e1e 0%, #121212 100%);
      color: white;
      overflow-x: hidden;
    }

    /* TOPBAR */
    .topbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 24px;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(10px);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .logo {
      font-size: 28px;
      font-weight: bold;
      color: #1db954;
    }

    .user-menu {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, #1db954, #1ed760);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .user-avatar:hover {
      transform: scale(1.1);
    }

    .btn-settings {
      padding: 8px 16px;
      background: transparent;
      border: 2px solid #1db954;
      color: #1db954;
      border-radius: 20px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s;
    }

    .btn-settings:hover {
      background: #1db954;
      color: black;
    }

    /* LAYOUT */
    .dashboard-layout {
      display: flex;
      min-height: calc(100vh - 72px);
    }

    /* SIDEBAR */
    .sidebar {
      width: 240px;
      background: rgba(0, 0, 0, 0.4);
      padding: 24px 16px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .sidebar-item {
      padding: 12px 16px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 14px;
      color: #b3b3b3;
    }

    .sidebar-item:hover,
    .sidebar-item.active {
      background: rgba(29, 185, 84, 0.1);
      color: #1db954;
    }

    /* CONTENT */
    .content {
      flex: 1;
      padding: 24px;
      overflow-y: auto;
    }

    .section-title {
      font-size: 24px;
      margin-bottom: 20px;
      font-weight: bold;
    }

    /* UPLOAD SECTION */
    .upload-section {
      background: linear-gradient(135deg, #1db954 0%, #1ed760 100%);
      padding: 32px;
      border-radius: 16px;
      margin-bottom: 32px;
      display: flex;
      align-items: center;
      gap: 24px;
    }

    .upload-icon {
      font-size: 48px;
    }

    .upload-content h3 {
      font-size: 20px;
      margin-bottom: 8px;
      color: black;
    }

    .upload-content p {
      color: rgba(0, 0, 0, 0.7);
      margin-bottom: 16px;
    }

    .btn-upload {
      padding: 12px 24px;
      background: black;
      color: white;
      border: none;
      border-radius: 24px;
      cursor: pointer;
      font-weight: bold;
      transition: transform 0.2s;
    }

    .btn-upload:hover {
      transform: scale(1.05);
    }

    /* SONG GRID */
    .song-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 20px;
      margin-bottom: 32px;
    }

    .song-card {
      background: rgba(255, 255, 255, 0.05);
      padding: 16px;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s;
      text-decoration: none;
      color: white;
      position: relative;
      overflow: hidden;
    }

    .song-card:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: translateY(-4px);
    }

    .song-cover {
      width: 100%;
      aspect-ratio: 1;
      border-radius: 8px;
      background-size: cover;
      background-position: center;
      margin-bottom: 12px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
    }

    .song-card h3 {
      font-size: 14px;
      margin-bottom: 4px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .song-card p {
      font-size: 12px;
      color: #b3b3b3;
    }

    .play-btn {
      position: absolute;
      bottom: 80px;
      right: 16px;
      width: 48px;
      height: 48px;
      background: #1db954;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      opacity: 0;
      transform: translateY(8px);
      transition: all 0.3s;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
    }

    .song-card:hover .play-btn {
      opacity: 1;
      transform: translateY(0);
    }

    /* MODAL */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: #282828;
      padding: 32px;
      border-radius: 16px;
      width: 90%;
      max-width: 500px;
      max-height: 80vh;
      overflow-y: auto;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }

    .modal-header h2 {
      font-size: 24px;
    }

    .btn-close {
      background: none;
      border: none;
      color: white;
      font-size: 28px;
      cursor: pointer;
      padding: 0;
      width: 32px;
      height: 32px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-size: 14px;
      font-weight: bold;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 12px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      color: white;
      font-size: 14px;
    }

    .form-group input:focus {
      outline: none;
      border-color: #1db954;
    }

    .preview-banner {
      width: 100%;
      height: 200px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      background-size: cover;
      background-position: center;
      margin-top: 12px;
    }

    .btn-submit {
      width: 100%;
      padding: 14px;
      background: #1db954;
      border: none;
      border-radius: 24px;
      color: black;
      font-weight: bold;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-submit:hover {
      background: #1ed760;
      transform: scale(1.02);
    }

    .btn-submit:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* RESPONSIVE */
    @media (max-width: 768px) {
      .dashboard-layout {
        flex-direction: column;
      }

      .sidebar {
        width: 100%;
        flex-direction: row;
        overflow-x: auto;
        padding: 12px;
      }

      .sidebar-item {
        white-space: nowrap;
      }

      .upload-section {
        flex-direction: column;
        text-align: center;
      }

      .song-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>
<body>

  <!-- TOPBAR -->
  <div class="topbar">
    <div class="logo">Spotify</div>
    <div class="user-menu">
      <button class="btn-settings" onclick="openSettings()">‚öôÔ∏è Pengaturan</button>
      <div class="user-avatar" onclick="openSettings()">U</div>
    </div>
  </div>

  <!-- LAYOUT -->
  <div class="dashboard-layout">
    
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="sidebar-item active" onclick="showSection('home')">
        üè† Home
      </div>
      <div class="sidebar-item" onclick="showSection('search')">
        üîç Search
      </div>
      <div class="sidebar-item" onclick="showSection('library')">
        üéµ Your Library
      </div>
      <div class="sidebar-item" onclick="showSection('upload')">
        ‚ûï Upload Lagu
      </div>
    </aside>

    <!-- CONTENT -->
    <main class="content">
      <h2 class="section-title">Good Evening</h2>

      <!-- SPOTIFY SEARCH SECTION -->
      <div class="upload-section">
        <div class="upload-icon">üéµ</div>
        <div class="upload-content">
          <h3>Cari & Import dari Spotify</h3>
          <p>Cari lagu dari Spotify dan tambahkan ke library kamu</p>
          <div style="display: flex; gap: 10px; margin-top: 12px;">
            <input type="text" id="spotifySearch" placeholder="Cari lagu di Spotify..." 
                   style="flex: 1; padding: 10px; border-radius: 20px; border: none; background: rgba(0,0,0,0.3); color: white;"
                   onkeypress="if(event.key==='Enter') searchSpotify()">
            <button class="btn-upload" onclick="searchSpotify()">üîç Cari</button>
            <button class="btn-upload" onclick="openUploadModal()">üì§ Upload File</button>
          </div>
        </div>
      </div>

      <!-- SPOTIFY RESULTS -->
      <div id="spotifyResults" style="display: none; margin-bottom: 32px;">
        <h3 style="margin-bottom: 16px; color: #1db954;">Hasil Pencarian Spotify</h3>
        <div class="song-grid" id="spotifyGrid"></div>
      </div>

      <!-- SONG GRID -->
      <div class="song-grid" id="songGrid">
        <a href="anugerah.html" class="song-card">
          <div class="song-cover" style="background-image: url('ya.jpg')"></div>
          <div class="play-btn">‚ñ∂</div>
          <h3>Anugerah Terindah</h3>
          <p>Andmesh Kamaleng</p>
        </a>

        <a href="saktane2.html" class="song-card">
          <div class="song-cover" style="background-image: url('ya1.jpg')"></div>
          <div class="play-btn">‚ñ∂</div>
          <h3>Saktane 2</h3>
          <p>Yadesta</p>
        </a>

        <a href="Nanti Kita Seperti Ini.html" class="song-card">
          <div class="song-cover" style="background-image: url('nanti.jpg')"></div>
          <div class="play-btn">‚ñ∂</div>
          <h3>Nanti Kita Seperti Ini</h3>
          <p>Batas Senja</p>
        </a>

        <a href="cintanya-aku.html" class="song-card">
          <div class="song-cover" style="background-image: url('3.jpg')"></div>
          <div class="play-btn">‚ñ∂</div>
          <h3>Cintanya Aku</h3>
          <p>Arsy Widianto & Tiara Andini</p>
        </a>
      </div>
    </main>
  </div>

  <!-- MODAL UPLOAD -->
  <div class="modal" id="uploadModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Upload Lagu Baru</h2>
        <button class="btn-close" onclick="closeUploadModal()">√ó</button>
      </div>
      
      <form onsubmit="uploadSong(event)" enctype="multipart/form-data">
        <div class="form-group">
          <label>Judul Lagu</label>
          <input type="text" name="title" placeholder="Masukkan judul lagu" required>
        </div>

        <div class="form-group">
          <label>Artis</label>
          <input type="text" name="artist" placeholder="Nama artis" required>
        </div>

        <div class="form-group">
          <label>Banner Lagu (Upload Gambar)</label>
          <input type="file" id="songBanner" name="banner" accept="image/*" onchange="previewBanner()">
          <div class="preview-banner" id="previewBanner"></div>
        </div>

        <div class="form-group">
          <label>File Audio (Upload MP3/WAV)</label>
          <input type="file" name="audio" accept="audio/*" required>
        </div>

        <button type="submit" class="btn-submit" id="uploadBtn">Upload Lagu</button>
      </form>
    </div>
  </div>

  <!-- MODAL SETTINGS -->
  <div class="modal" id="settingsModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Pengaturan Akun</h2>
        <button class="btn-close" onclick="closeSettings()">√ó</button>
      </div>
      
      <form onsubmit="saveSettings(event)">
        <div class="form-group">
          <label>Username</label>
          <input type="text" id="settingsUsername" placeholder="Username" required>
        </div>

        <div class="form-group">
          <label>Email</label>
          <input type="email" id="settingsEmail" placeholder="email@example.com">
        </div>

        <div class="form-group">
          <label>Nama Tampilan</label>
          <input type="text" id="settingsDisplayName" placeholder="Nama kamu">
        </div>

        <div class="form-group">
          <label>Tema</label>
          <select id="settingsTheme">
            <option value="dark">Dark Mode</option>
            <option value="light">Light Mode</option>
          </select>
        </div>

        <div class="form-group">
          <label>Kualitas Audio</label>
          <select id="settingsQuality">
            <option value="high">High (320kbps)</option>
            <option value="normal">Normal (160kbps)</option>
            <option value="low">Low (96kbps)</option>
          </select>
        </div>

        <button type="submit" class="btn-submit">Simpan Pengaturan</button>
      </form>
    </div>
  </div>

  <script>
    // Search Spotify
    async function searchSpotify() {
      const query = document.getElementById('spotifySearch').value.trim();
      
      if (!query) {
        alert('Masukkan kata kunci pencarian');
        return;
      }
      
      const resultsDiv = document.getElementById('spotifyResults');
      const grid = document.getElementById('spotifyGrid');
      
      resultsDiv.style.display = 'block';
      grid.innerHTML = '<p style="color: #b3b3b3;">Mencari di Spotify...</p>';
      
      try {
        const response = await fetch(`api/spotify.php?action=search&q=${encodeURIComponent(query)}`);
        const result = await response.json();
        
        if (result.success && result.data.length > 0) {
          renderSpotifyResults(result.data);
        } else {
          grid.innerHTML = '<p style="color: #b3b3b3;">Tidak ada hasil ditemukan</p>';
        }
      } catch (error) {
        grid.innerHTML = '<p style="color: #ff4d4d;">Error: ' + error.message + '</p>';
      }
    }

    // Render Spotify Results
    function renderSpotifyResults(tracks) {
      const grid = document.getElementById('spotifyGrid');
      
      let html = '';
      tracks.forEach(track => {
        const banner = track.banner || 'default-cover.jpg';
        const previewAvailable = track.preview_url ? '‚ñ∂' : 'üîí';
        
        html += `
          <div class="song-card" style="position: relative;">
            <div class="song-cover" style="background-image: url('${banner}')"></div>
            <div class="play-btn" onclick="playSpotifyPreview('${track.preview_url}', '${track.title}', '${track.artist}')">${previewAvailable}</div>
            <h3 title="${track.title}">${track.title}</h3>
            <p title="${track.artist}">${track.artist}</p>
            <button onclick="importFromSpotify('${track.id}', '${track.title.replace(/'/g, "\\'")}', '${track.artist.replace(/'/g, "\\'")}', '${banner}', '${track.preview_url || ''}')" 
                    style="width: 100%; margin-top: 8px; padding: 8px; background: #1db954; border: none; border-radius: 20px; color: black; font-weight: bold; cursor: pointer; font-size: 12px;">
              ‚ûï Tambahkan
            </button>
          </div>
        `;
      });
      
      grid.innerHTML = html;
    }

    // Play Spotify Preview
    function playSpotifyPreview(previewUrl, title, artist) {
      if (!previewUrl) {
        alert('Preview tidak tersedia untuk lagu ini');
        return;
      }
      
      playSong(previewUrl, title, artist);
    }

    // Import from Spotify
    async function importFromSpotify(spotifyId, title, artist, banner, previewUrl) {
      if (!previewUrl) {
        alert('‚ö†Ô∏è Lagu ini tidak memiliki preview audio. Silakan upload file audio sendiri.');
        return;
      }
      
      if (!confirm(`Import "${title}" oleh ${artist}?`)) {
        return;
      }
      
      try {
        // Download banner
        const bannerBlob = await fetch(banner).then(r => r.blob());
        
        // Download preview audio
        const audioBlob = await fetch(previewUrl).then(r => r.blob());
        
        // Create FormData
        const formData = new FormData();
        formData.append('title', title);
        formData.append('artist', artist);
        formData.append('banner', bannerBlob, 'banner.jpg');
        formData.append('audio', audioBlob, 'preview.mp3');
        
        // Upload to server
        const response = await fetch('api/upload.php', {
          method: 'POST',
          body: formData
        });
        
        const result = await response.json();
        
        if (result.success) {
          alert('‚úÖ Lagu berhasil ditambahkan!');
          loadSongs(); // Reload songs
          
          // Clear Spotify results
          document.getElementById('spotifyResults').style.display = 'none';
          document.getElementById('spotifySearch').value = '';
        } else {
          alert('‚ùå ' + result.message);
        }
      } catch (error) {
        alert('‚ùå Error: ' + error.message);
      }
    }

    // Load songs from database
    async function loadSongs() {
      try {
        const response = await fetch('api/songs.php');
        const result = await response.json();
        
        if (result.success) {
          renderSongs(result.data);
        }
      } catch (error) {
        console.error('Error loading songs:', error);
        // Jika API belum ready, tetap tampilkan lagu default
      }
    }

    // Preview banner
    function previewBanner() {
      const file = document.getElementById('songBanner').files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          document.getElementById('previewBanner').style.backgroundImage = `url('${e.target.result}')`;
        };
        reader.readAsDataURL(file);
      }
    }

    // Upload song
    async function uploadSong(e) {
      e.preventDefault();
      
      const uploadBtn = document.getElementById('uploadBtn');
      uploadBtn.disabled = true;
      uploadBtn.textContent = 'Uploading...';
      
      const formData = new FormData(e.target);
      
      try {
        const response = await fetch('api/upload.php', {
          method: 'POST',
          body: formData
        });
        
        const result = await response.json();
        
        if (result.success) {
          alert('‚úÖ ' + result.message);
          e.target.reset();
          document.getElementById('previewBanner').style.backgroundImage = '';
          closeUploadModal();
          loadSongs(); // Reload songs
        } else {
          alert('‚ùå ' + result.message);
        }
      } catch (error) {
        alert('‚ùå Error: ' + error.message);
      } finally {
        uploadBtn.disabled = false;
        uploadBtn.textContent = 'Upload Lagu';
      }
    }

    // Render songs
    function renderSongs(dbSongs = []) {
      const grid = document.getElementById('songGrid');
      
      // Default songs (keep existing)
      let html = `
        <a href="anugerah.html" class="song-card">
          <div class="song-cover" style="background-image: url('ya.jpg')"></div>
          <div class="play-btn">‚ñ∂</div>
          <h3>Anugerah Terindah</h3>
          <p>Andmesh Kamaleng</p>
        </a>

        <a href="saktane2.html" class="song-card">
          <div class="song-cover" style="background-image: url('ya1.jpg')"></div>
          <div class="play-btn">‚ñ∂</div>
          <h3>Saktane 2</h3>
          <p>Yadesta</p>
        </a>

        <a href="Nanti Kita Seperti Ini.html" class="song-card">
          <div class="song-cover" style="background-image: url('nanti.jpg')"></div>
          <div class="play-btn">‚ñ∂</div>
          <h3>Nanti Kita Seperti Ini</h3>
          <p>Batas Senja</p>
        </a>

        <a href="cintanya-aku.html" class="song-card">
          <div class="song-cover" style="background-image: url('3.jpg')"></div>
          <div class="play-btn">‚ñ∂</div>
          <h3>Cintanya Aku</h3>
          <p>Arsy Widianto & Tiara Andini</p>
        </a>
      `;
      
      // Add songs from database
      dbSongs.forEach(song => {
        const banner = song.banner || 'default-cover.jpg';
        html += `
          <div class="song-card" onclick="playSong('${song.audio_file}', '${song.title}', '${song.artist}')">
            <div class="song-cover" style="background-image: url('${banner}')"></div>
            <div class="play-btn">‚ñ∂</div>
            <h3>${song.title}</h3>
            <p>${song.artist}</p>
          </div>
        `;
      });
      
      grid.innerHTML = html;
    }

    // Play song function
    function playSong(audioFile, title, artist) {
      // Create simple player
      const playerHtml = `
        <div style="position: fixed; bottom: 0; left: 0; right: 0; background: #181818; padding: 16px; z-index: 1000;">
          <div style="max-width: 1200px; margin: 0 auto; display: flex; align-items: center; gap: 16px;">
            <div style="flex: 1;">
              <div style="font-weight: bold;">${title}</div>
              <div style="font-size: 12px; color: #b3b3b3;">${artist}</div>
            </div>
            <audio controls autoplay style="flex: 2;">
              <source src="${audioFile}" type="audio/mpeg">
            </audio>
          </div>
        </div>
      `;
      
      // Remove existing player
      const existingPlayer = document.querySelector('.music-player');
      if (existingPlayer) existingPlayer.remove();
      
      // Add new player
      const player = document.createElement('div');
      player.className = 'music-player';
      player.innerHTML = playerHtml;
      document.body.appendChild(player);
    }

    // Modal functions
    function openUploadModal() {
      document.getElementById('uploadModal').classList.add('active');
    }

    function closeUploadModal() {
      document.getElementById('uploadModal').classList.remove('active');
    }

    function openSettings() {
      const settings = JSON.parse(localStorage.getItem('spotify_settings')) || {};
      document.getElementById('settingsUsername').value = settings.username || '';
      document.getElementById('settingsEmail').value = settings.email || '';
      document.getElementById('settingsDisplayName').value = settings.displayName || '';
      document.getElementById('settingsTheme').value = settings.theme || 'dark';
      document.getElementById('settingsQuality').value = settings.quality || 'high';
      
      document.getElementById('settingsModal').classList.add('active');
    }

    function closeSettings() {
      document.getElementById('settingsModal').classList.remove('active');
    }

    function saveSettings(e) {
      e.preventDefault();
      
      const settings = {
        username: document.getElementById('settingsUsername').value,
        email: document.getElementById('settingsEmail').value,
        displayName: document.getElementById('settingsDisplayName').value,
        theme: document.getElementById('settingsTheme').value,
        quality: document.getElementById('settingsQuality').value
      };

      localStorage.setItem('spotify_settings', JSON.stringify(settings));
      
      // Update avatar
      const avatar = document.querySelector('.user-avatar');
      avatar.textContent = settings.displayName ? settings.displayName[0].toUpperCase() : 'U';
      
      closeSettings();
      alert('‚úÖ Pengaturan berhasil disimpan!');
    }

    function showSection(section) {
      // Update active sidebar
      document.querySelectorAll('.sidebar-item').forEach(item => {
        item.classList.remove('active');
      });
      event.target.classList.add('active');
      
      // Handle section display
      if (section === 'upload') {
        openUploadModal();
      }
    }

    // Load songs on page load
    loadSongs();

    // Load user settings
    const settings = JSON.parse(localStorage.getItem('spotify_settings')) || {};
    if (settings.displayName) {
      document.querySelector('.user-avatar').textContent = settings.displayName[0].toUpperCase();
    }
  </script>

</body>
</html>
